[
  {
    "definition": " SELECT c.org_id,\n    skill_item.skill_item AS skill_name,\n    count(*) AS candidate_count,\n    count(\n        CASE\n            WHEN (jc.stage = 'hired'::candidate_stage) THEN 1\n            ELSE NULL::integer\n        END) AS hired_with_skill,\n    count(\n        CASE\n            WHEN (jc.stage = ANY (ARRAY['interview'::candidate_stage, 'offer'::candidate_stage, 'hired'::candidate_stage])) THEN 1\n            ELSE NULL::integer\n        END) AS quality_candidates_with_skill,\n        CASE\n            WHEN (count(*) > 0) THEN (((count(\n            CASE\n                WHEN (jc.stage = 'hired'::candidate_stage) THEN 1\n                ELSE NULL::integer\n            END))::double precision / (count(*))::double precision) * (100)::double precision)\n            ELSE (0)::double precision\n        END AS skill_hire_rate,\n    avg(\n        CASE\n            WHEN (jc.stage = 'hired'::candidate_stage) THEN EXTRACT(days FROM (jc.updated_at - jc.created_at))\n            ELSE NULL::numeric\n        END) AS avg_time_to_hire_with_skill,\n    avg(\n        CASE\n            WHEN ((c.skill_levels IS NOT NULL) AND (c.skill_levels ? skill_item.skill_item)) THEN\n            CASE (c.skill_levels ->> skill_item.skill_item)\n                WHEN 'Beginner'::text THEN 1\n                WHEN 'Intermediate'::text THEN 2\n                WHEN 'Advanced'::text THEN 3\n                WHEN 'Expert'::text THEN 4\n                ELSE\n                CASE\n                    WHEN ((c.skill_levels ->> skill_item.skill_item) ~ '^[0-9]+$'::text) THEN ((c.skill_levels ->> skill_item.skill_item))::integer\n                    ELSE NULL::integer\n                END\n            END\n            ELSE NULL::integer\n        END) AS avg_proficiency_level,\n    mode() WITHIN GROUP (ORDER BY\n        CASE\n            WHEN ((c.skill_levels IS NOT NULL) AND (c.skill_levels ? skill_item.skill_item)) THEN (c.skill_levels ->> skill_item.skill_item)\n            ELSE NULL::text\n        END) AS most_common_proficiency\n   FROM ((candidates c\n     CROSS JOIN LATERAL unnest(c.skills) skill_item(skill_item))\n     LEFT JOIN job_candidate jc ON ((c.id = jc.candidate_id)))\n  WHERE ((c.skills IS NOT NULL) AND (array_length(c.skills, 1) > 0))\n  GROUP BY c.org_id, skill_item.skill_item\n HAVING (count(*) >= 2);"
  }
]